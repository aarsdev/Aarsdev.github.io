<!DOCTYPE html>
<html>
<head>
    <title>NEONVERSE PRO | BATTLE ROYALE</title>
    <style>
        body { background: #020205; color: #00f2ff; font-family: 'Orbitron', sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        #overlay { position: fixed; inset: 0; background: radial-gradient(circle, #1a0033 0%, #000 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; transition: 0.5s; }
        h1 { font-size: 80px; margin: 0; text-shadow: 0 0 20px #ff00ff, 0 0 40px #ff00ff; color: #fff; font-style: italic; }
        input { padding: 20px; width: 300px; background: rgba(255,255,255,0.05); border: 2px solid #00f2ff; color: #00f2ff; font-size: 24px; text-align: center; margin-top: 20px; outline: none; }
        #game-ui { position: absolute; top: 20px; width: 95%; display: flex; justify-content: space-between; pointer-events: none; }
        .stat-box { background: rgba(0,0,0,0.6); border-left: 4px solid #ff00ff; padding: 10px 20px; }
        canvas { background: #000; border: 2px solid #333; cursor: crosshair; box-shadow: 0 0 50px rgba(0, 242, 255, 0.1); }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap" rel="stylesheet">
</head>
<body>

    <div id="overlay">
        <h1>NEONVERSE</h1>
        <p style="letter-spacing: 10px; color: #ff00ff;">ULTRA-PRO ARENA</p>
        <input type="text" id="username" placeholder="CALLSIGN..." maxlength="10">
        <button onclick="deploy()" style="margin-top: 30px; padding: 20px 60px; font-family: 'Orbitron'; background: #00f2ff; color: #000; border: none; font-size: 20px; cursor: pointer; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);">DEPLOY NOW</button>
    </div>

    <div id="game-ui">
        <div class="stat-box">MASS: <span id="my-mass">0</span></div>
        <div class="stat-box" style="border-color: #00f2ff;">RANKING: <div id="top-ranks"></div></div>
    </div>

    <canvas id="arena"></canvas>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, onDisconnect, update, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD9I2tePOBy4OdbFjbAzxAPvvziqvoe0QI",
            authDomain: "neonverse-aars.firebaseapp.com",
            projectId: "neonverse-aars",
            storageBucket: "neonverse-aars.firebasestorage.app",
            databaseURL: "https://neonverse-aars-default-rtdb.firebaseio.com",
            messagingSenderId: "612438599755",
            appId: "1:612438599755:web:43f1c0a553d56c3aa045ce"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const canvas = document.getElementById('arena');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let me = { id: 'p_'+Math.random().toString(36).substr(2,9), name: '', x: Math.random()*2000, y: Math.random()*2000, score: 10, color: `hsl(${Math.random()*360}, 100%, 50%)`, dash: 0 };
        let players = {}, orbs = {};
        let keys = {};

        window.deploy = () => {
            me.name = document.getElementById('username').value || "PLAYER";
            document.getElementById('overlay').style.opacity = '0';
            setTimeout(() => document.getElementById('overlay').remove(), 500);
            startLoop();
        };

        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        function startLoop() {
            // Movement Logic
            setInterval(() => {
                let speed = 5 / (me.score / 20 + 1);
                if (keys['Space'] && me.score > 15) { speed *= 4; me.score -= 0.1; } // Dash burns mass
                
                if (keys['KeyW'] || keys['ArrowUp']) me.y -= speed;
                if (keys['KeyS'] || keys['ArrowDown']) me.y += speed;
                if (keys['KeyA'] || keys['ArrowLeft']) me.x -= speed;
                if (keys['KeyD'] || keys['ArrowRight']) me.x += speed;

                update(ref(db, 'players/' + me.id), me);
                document.getElementById('my-mass').innerText = Math.floor(me.score);
            }, 1000/60);

            onDisconnect(ref(db, 'players/' + me.id)).remove();
        }

        // Global Sync
        onValue(ref(db), (snap) => {
            const data = snap.val() || {};
            players = data.players || {};
            orbs = data.orbs || {};
            
            // Check for Orb collisions locally
            Object.keys(orbs).forEach(oid => {
                let o = orbs[oid];
                let dist = Math.hypot(me.x - o.x, me.y - o.y);
                if (dist < me.score + 5) {
                    me.score += 2;
                    remove(ref(db, 'orbs/' + oid));
                    // Spawn new orb
                    set(ref(db, 'orbs/o_' + Math.random().toString(36).substr(2,5)), { x: Math.random()*2000, y: Math.random()*2000 });
                }
            });
        });

        function render() {
            ctx.fillStyle = '#020205';
            ctx.fillRect(0,0,canvas.width, canvas.height);

            // Camera follow
            ctx.save();
            ctx.translate(canvas.width/2 - me.x, canvas.height/2 - me.y);

            // Draw Background Grid
            ctx.strokeStyle = '#111';
            for(let x=0; x<2000; x+=100) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,2000); ctx.stroke(); }
            for(let y=0; y<2000; y+=100) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(2000,y); ctx.stroke(); }

            // Render Orbs
            Object.values(orbs).forEach(o => {
                ctx.fillStyle = '#ff00ff';
                ctx.beginPath(); ctx.arc(o.x, o.y, 4, 0, Math.PI*2); ctx.fill();
            });

            // Render Players
            Object.values(players).forEach(p => {
                ctx.shadowBlur = 20; ctx.shadowColor = p.color;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.score, 0, Math.PI*2);
                ctx.fill();
                
                ctx.shadowBlur = 0;
                ctx.fillStyle = "#fff";
                ctx.font = "bold 14px Arial";
                ctx.textAlign = "center";
                ctx.fillText(p.name, p.x, p.y - p.score - 10);
            });

            ctx.restore();
            requestAnimationFrame(render);
        }
        render();
    </script>
</body>
</html>
