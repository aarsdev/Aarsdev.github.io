<!DOCTYPE html>
<html>
<head>
    <title>NEONVERSE | Multiplayer Arena</title>
    <style>
        body { background-color: #050505; color: #00f2ff; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
        input#username { padding: 15px; font-size: 20px; background: #000; color: #00f2ff; border: 2px solid #00f2ff; text-align: center; outline: none; box-shadow: 0 0 15px #00f2ff; }
        #game-canvas { background: #000; border: 4px solid #00f2ff; box-shadow: 0 0 20px #00f2ff; border-radius: 10px; margin-top: 20px; }
        #chat-box { position: absolute; bottom: 20px; left: 20px; background: rgba(0,0,0,0.8); padding: 10px; border: 1px solid #00f2ff; width: 250px; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 style="font-size: 50px; text-shadow: 0 0 20px #ff00ff; color: #ff00ff;">NEONVERSE</h1>
        <p>ENTER YOUR CODENAME</p>
        <input type="text" id="username" placeholder="PLAYER_1" maxlength="12">
        <button onclick="joinGame()" style="margin-top: 20px; padding: 10px 30px; cursor: pointer; background: #00f2ff; font-weight: bold;">DEPLOY</button>
    </div>

    <h1>NEONVERSE</h1>
    <canvas id="game-canvas" width="1000" height="600"></canvas>

    <div id="chat-box">
        <div id="messages" style="height: 100px; overflow-y: auto; font-size: 12px;"></div>
        <input type="text" id="chat-input" placeholder="Press Enter to chat..." style="width: 90%; background: #000; color: #00f2ff; border: 1px solid #00f2ff;">
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, onDisconnect, push, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD9I2tePOBy4OdbFjbAzxAPvvziqvoe0QI",
            authDomain: "neonverse-aars.firebaseapp.com",
            projectId: "neonverse-aars",
            storageBucket: "neonverse-aars.firebasestorage.app",
            databaseURL: "https://neonverse-aars-default-rtdb.firebaseio.com", // Double check your URL in Firebase!
            messagingSenderId: "612438599755",
            appId: "1:612438599755:web:43f1c0a553d56c3aa045ce"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let myName = "Guest";
        let myId = "p_" + Math.floor(Math.random() * 9999);
        let x = 500, y = 300, power = 1;
        const color = `hsl(${Math.random() * 360}, 100%, 60%)`;

        window.joinGame = function() {
            const input = document.getElementById('username').value;
            if (input) myName = input;
            document.getElementById('overlay').style.display = 'none';
            updateData();
        }

        function updateData() {
            set(ref(db, 'players/' + myId), { name: myName, x, y, color, power });
        }

        onDisconnect(ref(db, 'players/' + myId)).remove();

        // Controls
        document.addEventListener("keydown", (e) => {
            if (document.getElementById('overlay').style.display === 'none') {
                if (e.key === "w" || e.key === "ArrowUp") y -= 10;
                if (e.key === "s" || e.key === "ArrowDown") y += 10;
                if (e.key === "a" || e.key === "ArrowLeft") x -= 10;
                if (e.key === "d" || e.key === "ArrowRight") x += 10;
                updateData();
            }
        });

        const canvas = document.getElementById("game-canvas");
        const ctx = canvas.getContext("2d");

        // Game Loop
        onValue(ref(db, 'players'), (snapshot) => {
            const players = snapshot.val() || {};
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw Grid
            ctx.strokeStyle = "#111";
            for(let i=0; i<canvas.width; i+=50) { ctx.strokeRect(i, 0, 50, canvas.height); }

            Object.values(players).forEach(p => {
                // Glow
                ctx.shadowBlur = 15; ctx.shadowColor = p.color;
                ctx.fillStyle = p.color;
                
                // Player Square
                ctx.fillRect(p.x, p.y, 20, 20);
                
                // Name Tag (The "Huge" part)
                ctx.shadowBlur = 0;
                ctx.fillStyle = "white";
                ctx.font = "bold 12px Arial";
                ctx.fillText(p.name, p.x - 10, p.y - 10);
            });
        });
    </script>
</body>
</html>
