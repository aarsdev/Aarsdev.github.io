<!DOCTYPE html>
<html>
<head>
    <title>NEONVERSE | BATTLE WARZONE</title>
    <style>
        body { background: #010103; color: #fff; font-family: 'Orbitron', sans-serif; margin: 0; overflow: hidden; }
        #hud { position: fixed; top: 0; width: 100%; padding: 20px; display: flex; justify-content: space-between; pointer-events: none; z-index: 100; }
        #xp-bar { width: 400px; height: 12px; border: 2px solid #00f2ff; background: rgba(0,242,255,0.1); border-radius: 6px; }
        #xp-fill { height: 100%; width: 0%; background: #00f2ff; box-shadow: 0 0 15px #00f2ff; transition: 0.3s; }
        #kill-feed { position: fixed; top: 100px; right: 20px; text-align: right; color: #ff00ff; font-size: 14px; text-shadow: 0 0 5px #000; }
        #ability-slots { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 20px; }
        .ability { width: 70px; height: 70px; border: 2px solid #555; background: rgba(0,0,0,0.8); display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; }
        .ready { border-color: #00f2ff; box-shadow: 0 0 10px #00f2ff; }
        canvas { cursor: crosshair; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
</head>
<body>

    <div id="hud">
        <div>
            <h1 style="margin:0; text-shadow: 0 0 20px #ff00ff; color: #ff00ff;">NEONVERSE: WARZONE</h1>
            <div id="xp-bar"><div id="xp-fill"></div></div>
            <p id="level-display">RANK: 1 - RECRUIT</p>
        </div>
        <div id="kill-feed"></div>
    </div>

    <div id="ability-slots">
        <div class="ability ready" id="ab1"><span>[L-CLICK]</span><br>PLASMA</div>
        <div class="ability" id="ab2"><span>[SPACE]</span><br>DASH</div>
        <div class="ability" id="ab3"><span>[SHIFT]</span><br>SHIELD</div>
    </div>

    <canvas id="warzone"></canvas>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, onDisconnect, push, remove, update } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD9I2tePOBy4OdbFjbAzxAPvvziqvoe0QI",
            authDomain: "neonverse-aars.firebaseapp.com",
            projectId: "neonverse-aars",
            storageBucket: "neonverse-aars.firebasestorage.app",
            databaseURL: "https://neonverse-aars-default-rtdb.firebaseio.com",
            messagingSenderId: "612438599755",
            appId: "1:612438599755:web:43f1c0a553d56c3aa045ce"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const canvas = document.getElementById('warzone');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let me = { id: 'u_'+Math.floor(Math.random()*999), x: 2500, y: 2500, hp: 100, xp: 0, lvl: 1, color: '#00f2ff' };
        let players = {}, projectiles = {}, keys = {};

        // ⚔️ COMBAT SYSTEM
        canvas.onmousedown = (e) => {
            const angle = Math.atan2(e.clientY - canvas.height/2, e.clientX - canvas.width/2);
            push(ref(db, 'warzone/projectiles'), { owner: me.id, x: me.x, y: me.y, angle: angle, speed: 15, damage: 10 });
        };

        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        onValue(ref(db, 'warzone/projectiles'), (s) => projectiles = s.val() || {});
        onValue(ref(db, 'players'), (s) => players = s.val() || {});
        onDisconnect(ref(db, 'players/' + me.id)).remove();

        function gameLoop() {
            // Movement Physics
            let speed = 8;
            if (keys['Space']) speed = 20; // Dash ability
            if (keys['KeyW']) me.y -= speed;
            if (keys['KeyS']) me.y += speed;
            if (keys['KeyA']) me.x -= speed;
            if (keys['KeyD']) me.x += speed;

            set(ref(db, 'players/' + me.id), me);
            document.getElementById('xp-fill').style.width = (me.xp % 100) + '%';

            // Rendering Warzone
            ctx.fillStyle = '#010103'; ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.save(); ctx.translate(canvas.width/2 - me.x, canvas.height/2 - me.y);

            // Draw Dynamic Grid
            ctx.strokeStyle = '#0a0a1a';
            for(let i=0; i<5000; i+=200) {
                ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,5000); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(5000,i); ctx.stroke();
            }

            // Draw Projectiles
            Object.values(projectiles).forEach(p => {
                ctx.fillStyle = '#ff00ff';
                ctx.beginPath(); ctx.arc(p.x, p.y, 5, 0, Math.PI*2); ctx.fill();
            });

            // Draw Combatants
            Object.values(players).forEach(p => {
                ctx.shadowBlur = 20; ctx.shadowColor = p.color;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x-20, p.y-20, 40, 40);
                
                // Name & HP Bar
                ctx.shadowBlur = 0;
                ctx.fillStyle = "#fff";
                ctx.font = "bold 12px Orbitron";
                ctx.fillText(p.id + " [LVL "+p.lvl+"]", p.x-20, p.y-45);
                ctx.fillStyle = "red"; ctx.fillRect(p.x-20, p.y-40, 40, 5);
                ctx.fillStyle = "lime"; ctx.fillRect(p.x-20, p.y-40, (p.hp/100)*40, 5);
            });

            ctx.restore();
            requestAnimationFrame(gameLoop);
        }
        gameLoop();
    </script>
</body>
</html>
