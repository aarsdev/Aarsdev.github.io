<!DOCTYPE html>
<html>
<head>
    <title>NEON RIVALS | PRO EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; }
        #hud { position: fixed; bottom: 30px; left: 30px; color: #00f2ff; text-shadow: 0 0 10px #00f2ff; z-index: 10; }
        .weapon-info { font-size: 24px; border-left: 4px solid #ff00ff; padding-left: 15px; }
        #crosshair { position: fixed; top: 50%; left: 50%; width: 14px; height: 14px; border: 2px solid #fff; border-radius: 50%; transform: translate(-50%, -50%); }
    </style>
</head>
<body>

<div id="hud">
    <div class="weapon-info">
        <div id="w-name">PULSE RIFLE</div>
        <div style="font-size: 12px; color: #fff;">AMMO: âˆž</div>
    </div>
</div>
<div id="crosshair"></div>

<script type="importmap">{ "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }</script>

<script type="module">
import * as THREE from 'three';

// 1. ADVANCED ENGINE SETUP
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x020205);
scene.fog = new THREE.Fog(0x020205, 10, 500); // Hides the "edge" of the map

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.toneMapping = THREE.ReinhardToneMapping;
document.body.appendChild(renderer.domElement);

// 2. THE MAP (Massive "Grid-City" Style)
const floorGeo = new THREE.PlaneGeometry(1000, 1000);
const floorMat = new THREE.MeshStandardMaterial({ color: 0x050505, roughness: 0.1 });
const floor = new THREE.Mesh(floorGeo, floorMat);
floor.rotation.x = -Math.PI / 2;
scene.add(floor);

// Add "Neon Skyscrapers" to make the map look good
for(let i=0; i<50; i++) {
    const h = 10 + Math.random() * 50;
    const box = new THREE.Mesh(
        new THREE.BoxGeometry(10, h, 10),
        new THREE.MeshStandardMaterial({ color: 0x111111, emissive: 0x00f2ff, emissiveIntensity: 0.1 })
    );
    box.position.set(Math.random()*400-200, h/2, Math.random()*400-200);
    scene.add(box);
}

// 3. THE WEAPON (First-Person Model)
const gunGroup = new THREE.Group();
const barrel = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 2), new THREE.MeshStandardMaterial({color: 0x222222}));
barrel.rotation.x = Math.PI / 2;
const body = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.6, 1), new THREE.MeshStandardMaterial({color: 0x111111}));
body.position.z = -0.5;
const glow = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 1.2), new THREE.MeshStandardMaterial({color: 0x00f2ff, emissive: 0x00f2ff, emissiveIntensity: 5}));
glow.position.z = 0.2;
gunGroup.add(barrel, body, glow);
scene.add(gunGroup);

// 4. PHYSICS & CONTROLS
const keys = {};
let velocity = new THREE.Vector3();
window.onkeydown = (e) => keys[e.code] = true;
window.onkeyup = (e) => keys[e.code] = false;

// 5. COMBAT (VFX)
window.onmousedown = () => {
    // Muzzle Flash
    glow.material.emissiveIntensity = 20;
    setTimeout(() => glow.material.emissiveIntensity = 5, 50);
    
    // Kickback animation
    gunGroup.position.z += 0.2;
};

function animate() {
    requestAnimationFrame(animate);

    // Movement
    const speed = 0.15;
    if(keys['KeyW']) velocity.z = speed;
    else if(keys['KeyS']) velocity.z = -speed;
    else velocity.z *= 0.9;

    if(keys['KeyA']) camera.rotation.y += 0.03;
    if(keys['KeyD']) camera.rotation.y -= 0.03;

    camera.translateZ(-velocity.z);

    // Gun Sway & Position (Locks it to your hand/camera)
    const gunOffset = new THREE.Vector3(0.5, -0.5, -1.5); // Position gun to the side
    gunOffset.applyQuaternion(camera.quaternion);
    gunGroup.position.copy(camera.position).add(gunOffset);
    gunGroup.quaternion.copy(camera.quaternion);
    
    // Smooth recoil return
    gunGroup.position.lerp(camera.position.clone().add(gunOffset), 0.1);

    renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
