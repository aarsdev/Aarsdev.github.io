<!DOCTYPE html>
<html>
<head>
    <title>NEONVERSE | INFINITE ADVENTURE</title>
    <style>
        body { background: #020205; color: #00f2ff; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; }
        #ui { position: fixed; top: 20px; left: 20px; pointer-events: none; z-index: 10; }
        #chat { position: fixed; bottom: 20px; left: 20px; width: 300px; background: rgba(0,0,0,0.8); border: 1px solid #00f2ff; padding: 10px; }
        #inv { position: fixed; bottom: 20px; right: 20px; display: flex; gap: 10px; }
        .slot { width: 50px; height: 50px; border: 2px solid #333; display: flex; align-items: center; justify-content: center; background: #000; cursor: pointer; pointer-events: auto; }
        .active { border-color: #ff00ff; box-shadow: 0 0 15px #ff00ff; }
        canvas { display: block; }
    </style>
</head>
<body>

    <div id="ui">
        <h1 style="margin:0; font-size: 40px; text-shadow: 0 0 10px #00f2ff;">NEONVERSE VOXEL</h1>
        <p>CORES COLLECTED: <span id="score">0</span></p>
        <p style="font-size: 12px; color: #ff00ff;">TASK: Find the Hidden Golden Cores in the deep grid.</p>
    </div>

    <div id="chat">
        <div id="msgs" style="height: 100px; overflow-y: auto; font-size: 12px; margin-bottom: 5px;"></div>
        <input type="text" id="chatInput" placeholder="Press Enter to broadcast..." style="width: 90%; background: #000; color: #00f2ff; border: 1px solid #00f2ff;">
    </div>

    <div id="inv">
        <div class="slot active" data-clr="#00f2ff" onclick="sel(this)">ðŸ’ </div>
        <div class="slot" data-clr="#ff00ff" onclick="sel(this)">ðŸŒ¸</div>
        <div class="slot" data-clr="#ffff00" onclick="sel(this)">ðŸ”¥</div>
    </div>

    <canvas id="game"></canvas>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, onDisconnect, remove, push } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // Your Config from image_6339d1.jpg
        const firebaseConfig = {
            apiKey: "AIzaSyD9I2tePOBy4OdbFjbAzxAPvvziqvoe0QI",
            authDomain: "neonverse-aars.firebaseapp.com",
            projectId: "neonverse-aars",
            storageBucket: "neonverse-aars.firebasestorage.app",
            databaseURL: "https://neonverse-aars-default-rtdb.firebaseio.com",
            messagingSenderId: "612438599755",
            appId: "1:612438599755:web:43f1c0a553d56c3aa045ce"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const cvs = document.getElementById('game');
        const ctx = cvs.getContext('2d');
        cvs.width = window.innerWidth;
        cvs.height = window.innerHeight;

        let myId = "explorer_" + Math.floor(Math.random() * 9999);
        let camX = 2000, camY = 2000, score = 0, selClr = "#00f2ff";
        let players = {}, blocks = {}, keys = {};

        // ðŸ’  Interaction: Building like Minecraft
        cvs.onmousedown = (e) => {
            const wx = Math.floor((e.clientX + camX - cvs.width/2) / 40) * 40;
            const wy = Math.floor((e.clientY + camY - cvs.height/2) / 40) * 40;
            const bId = `${wx}_${wy}`;
            if (e.button === 0) set(ref(db, 'world/' + bId), { x: wx, y: wy, clr: selClr });
            else remove(ref(db, 'world/' + bId));
        };
        cvs.oncontextmenu = (e) => e.preventDefault();
        window.sel = (el) => {
            document.querySelectorAll('.slot').forEach(s => s.classList.remove('active'));
            el.classList.add('active'); selClr = el.dataset.clr;
        };

        // ðŸ’¬ Adventure Chat
        const cin = document.getElementById('chatInput');
        cin.onkeydown = (e) => {
            if(e.key === 'Enter' && cin.value) {
                push(ref(db, 'chat'), { name: myId.split('_')[1], txt: cin.value });
                cin.value = '';
            }
        };
        onValue(ref(db, 'chat'), (s) => {
            const m = s.val() || {};
            document.getElementById('msgs').innerHTML = Object.values(m).slice(-5).map(v => `<div><b>${v.name}:</b> ${v.txt}</div>`).join('');
        });

        // ðŸŒ World Sync
        onValue(ref(db, 'world'), (s) => { blocks = s.val() || {}; });
        onValue(ref(db, 'players'), (s) => { players = s.val() || {}; });
        onDisconnect(ref(db, 'players/' + myId)).remove();

        window.onkeydown = (e) => keys[e.key.toLowerCase()] = true;
        window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

        function play() {
            if(keys['w']) camY -= 8; if(keys['s']) camY += 8;
            if(keys['a']) camX -= 8; if(keys['d']) camX += 8;

            set(ref(db, 'players/' + myId), { x: camX, y: camY, clr: '#fff' });

            ctx.fillStyle = "#020205"; ctx.fillRect(0, 0, cvs.width, cvs.height);
            ctx.save(); ctx.translate(cvs.width/2 - camX, cvs.height/2 - camY);

            // Draw Persistent World
            Object.values(blocks).forEach(b => {
                ctx.shadowBlur = 10; ctx.shadowColor = b.clr; ctx.fillStyle = b.clr;
                ctx.fillRect(b.x + 2, b.y + 2, 36, 36);
            });

            // Draw Online Explorers
            Object.values(players).forEach(p => {
                ctx.shadowBlur = 0; ctx.fillStyle = "#fff";
                ctx.fillRect(p.x - 15, p.y - 15, 30, 30);
            });

            ctx.restore();
            requestAnimationFrame(play);
        }
        play();
    </script>
</body>
</html>
