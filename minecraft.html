<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NEONVERSE | GLOBAL ODYSSEY</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Orbitron', sans-serif; color: #fff; }
        #ui-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 10; }
        .hud-top { display: flex; justify-content: space-between; padding: 25px; background: linear-gradient(to bottom, rgba(0,242,255,0.2), transparent); }
        .quest-log { position: fixed; left: 20px; top: 120px; background: rgba(0,0,0,0.7); border-left: 4px solid #ff00ff; padding: 15px; width: 250px; }
        #inventory { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; pointer-events: auto; }
        .slot { width: 70px; height: 70px; border: 2px solid #444; background: #111; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; cursor: pointer; }
        .active-slot { border-color: #00f2ff; box-shadow: 0 0 15px #00f2ff; }
        #avatar-label { position: fixed; bottom: 120px; left: 50%; transform: translateX(-50%); color: #00f2ff; font-weight: bold; }
    </style>
</head>
<body>

<div id="ui-overlay">
    <div class="hud-top">
        <div>LEVEL <span id="lvl">1</span> [EXP: <span id="xp">0</span>/1000]</div>
        <div id="island-name" style="font-size: 24px; font-weight: 900; color: #ff00ff;">SECTOR: ORIGIN ISLE</div>
        <div id="weapon-name">EQUIPPED: NONE</div>
    </div>
    <div class="quest-log">
        <b style="color: #ff00ff;">CURRENT QUEST</b><br>
        <span id="quest-text">Travel to the "Crimson Island" at X: 4000 to find your first weapon.</span>
    </div>
    <div id="avatar-label">PLAYER_1</div>
</div>

<div id="inventory">
    <div class="slot active-slot">üëä<br>MELEE</div>
    <div class="slot">‚öîÔ∏è<br>BLADE</div>
    <div class="slot">üî´<br>RIFLE</div>
</div>

<canvas id="worldCanvas"></canvas>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, set, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyD9I2tePOBy4OdbFjbAzxAPvvziqvoe0QI",
    authDomain: "neonverse-aars.firebaseapp.com",
    projectId: "neonverse-aars",
    storageBucket: "neonverse-aars.firebasestorage.app",
    databaseURL: "https://neonverse-aars-default-rtdb.firebaseio.com",
    messagingSenderId: "612438599755",
    appId: "1:612438599755:web:43f1c0a553d56c3aa045ce"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const canvas = document.getElementById('worldCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth; canvas.height = window.innerHeight;

let myId = "USR_" + Math.floor(Math.random() * 9999);
let player = { x: 500, y: 500, vx: 0, vy: 0, anim: 0, hp: 100, xp: 0, lvl: 1, color: "#00f2ff" };
let others = {};

const keys = {};
window.onkeydown = (e) => keys[e.code] = true;
window.onkeyup = (e) => keys[e.code] = false;

function drawHumanoid(x, y, color, animFrame, isMe) {
    const sway = Math.sin(animFrame) * 5;
    const legSway = Math.sin(animFrame * 0.8) * 10;
    
    ctx.save();
    ctx.translate(x, y);
    ctx.shadowBlur = 15; ctx.shadowColor = color;

    // Head
    ctx.fillStyle = "#fff";
    ctx.beginPath(); ctx.arc(0, -50 + sway/2, 10, 0, Math.PI*2); ctx.fill();
    
    // Torso
    ctx.fillStyle = color;
    ctx.fillRect(-12, -35 + sway, 24, 35);
    
    // Arms
    ctx.fillRect(-22, -30 + sway, 8, 20); // Left
    ctx.fillRect(14, -30 + sway, 8, 20);  // Right
    
    // Legs (Realistic walking animation)
    ctx.fillRect(-10, 0, 8, 20 + legSway);
    ctx.fillRect(2, 0, 8, 20 - legSway);
    
    ctx.restore();
}

function update() {
    // Advanced Physics
    const speed = keys['ShiftLeft'] ? 12 : 6;
    let moving = false;
    if (keys['KeyW']) { player.y -= speed; moving = true; }
    if (keys['KeyS']) { player.y += speed; moving = true; }
    if (keys['KeyA']) { player.x -= speed; moving = true; }
    if (keys['KeyD']) { player.x += speed; moving = true; }
    
    if (moving) player.anim += 0.2;

    // Island/Sector Logic
    if (player.x > 3000) {
        document.getElementById('island-name').innerText = "SECTOR: CRIMSON RIFT";
        document.getElementById('island-name').style.color = "#ff0000";
    } else {
        document.getElementById('island-name').innerText = "SECTOR: ORIGIN ISLE";
        document.getElementById('island-name').style.color = "#ff00ff";
    }

    set(ref(db, 'players/' + myId), player);

    // Render Scene
    ctx.fillStyle = '#020205'; ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.save();
    ctx.translate(canvas.width/2 - player.x, canvas.height/2 - player.y);

    // Draw Map & Islands
    ctx.strokeStyle = '#111';
    for(let i=-5000; i<10000; i+=500) {
        ctx.beginPath(); ctx.moveTo(i, -5000); ctx.lineTo(i, 10000); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(-5000, i); ctx.lineTo(10000, i); ctx.stroke();
    }

    // Render All Humanoids
    onValue(ref(db, 'players'), (s) => others = s.val() || {});
    Object.values(others).forEach(p => {
        drawHumanoid(p.x, p.y, p.color, p.anim, p.id === myId);
    });

    ctx.restore();
    requestAnimationFrame(update);
}

onDisconnect(ref(db, 'players/' + myId)).remove();
update();
</script>
</body>
</html>
