<!DOCTYPE html>
<html>
<head>
    <title>NEONVERSE | HYPER BATTLE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Orbitron', sans-serif; }
        #ui-layer { position: fixed; inset: 0; pointer-events: none; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; }
        #rank-card { background: rgba(255,0,255,0.1); border-left: 5px solid #ff00ff; padding: 15px; width: 200px; }
        #kill-feed { color: #00f2ff; text-align: right; font-size: 14px; }
        #crosshair { position: fixed; width: 20px; height: 20px; border: 2px solid #fff; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 1000; }
    </style>
</head>
<body>

<div id="crosshair"></div>
<div id="ui-layer">
    <div id="rank-card">
        <div style="font-size: 10px;">GLOBAL RANK</div>
        <div id="player-rank" style="font-size: 24px; color: #ff00ff;">ELITE #1</div>
    </div>
    <div id="kill-feed">SYSTEM: ARENA LIVE</div>
</div>

<canvas id="battleCanvas"></canvas>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, set, onValue, onDisconnect, push, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

// Your Verified Config
const firebaseConfig = {
    apiKey: "AIzaSyD9I2tePOBy4OdbFjbAzxAPvvziqvoe0QI",
    authDomain: "neonverse-aars.firebaseapp.com",
    projectId: "neonverse-aars",
    storageBucket: "neonverse-aars.firebasestorage.app",
    databaseURL: "https://neonverse-aars-default-rtdb.firebaseio.com",
    messagingSenderId: "612438599755",
    appId: "1:612438599755:web:43f1c0a553d56c3aa045ce"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const canvas = document.getElementById('battleCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Player & Game State
let myId = "v_" + Math.floor(Math.random() * 999);
let player = { x: 500, y: 500, vx: 0, vy: 0, size: 30, color: "#ff00ff", state: "idle" };
let ball = { x: 0, y: 0, target: "", speed: 5 };
let participants = {};

// ðŸ’  Mouse Interaction (Parry Mechanic like Blade Ball)
window.onmousemove = (e) => {
    document.getElementById('crosshair').style.left = e.clientX + 'px';
    document.getElementById('crosshair').style.top = e.clientY + 'px';
};

window.onmousedown = () => {
    player.state = "parry"; // Activate block
    setTimeout(() => player.state = "idle", 150);
};

const keys = {};
window.onkeydown = (e) => keys[e.code] = true;
window.onkeyup = (e) => keys[e.code] = false;

// ðŸ’  The Hyper-Engine Loop
function engine() {
    // 60FPS Vector Physics
    const accel = 1.2;
    const friction = 0.92;
    if (keys['KeyW']) player.vy -= accel;
    if (keys['KeyS']) player.vy += accel;
    if (keys['KeyA']) player.vx -= accel;
    if (keys['KeyD']) player.vx += accel;

    player.vx *= friction;
    player.vy *= friction;
    player.x += player.vx;
    player.y += player.vy;

    // Sync to Firebase
    set(ref(db, 'arena/players/' + myId), player);

    // Render Scene
    ctx.fillStyle = '#020205';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw Grid with Motion Blur
    ctx.strokeStyle = '#111';
    for(let i=0; i<canvas.width; i+=100) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }

    // Draw Players & Parry Shield
    onValue(ref(db, 'arena/players'), (s) => participants = s.val() || {});
    Object.values(participants).forEach(p => {
        ctx.save();
        ctx.translate(p.x, p.y);
        
        // Glow Effect
        ctx.shadowBlur = 20; ctx.shadowColor = p.color;
        ctx.fillStyle = p.color;
        ctx.fillRect(-20, -20, 40, 40);

        if(p.state === "parry") {
            ctx.strokeStyle = "#fff";
            ctx.lineWidth = 4;
            ctx.strokeRect(-30, -30, 60, 60);
        }
        ctx.restore();
    });

    requestAnimationFrame(engine);
}

onDisconnect(ref(db, 'arena/players/' + myId)).remove();
engine();
</script>
</body>
</html>
