<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NEONVERSE | GLOBAL ODYSSEY</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #050010; overflow: hidden; font-family: 'Orbitron', sans-serif; color: #fff; }
        #ui-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 10; }
        .hud-top { display: flex; justify-content: space-between; padding: 25px; background: rgba(0,0,0,0.4); border-bottom: 2px solid #00f2ff; }
        .island-banner { font-size: 28px; font-weight: 900; text-transform: uppercase; letter-spacing: 5px; text-shadow: 0 0 20px #ff00ff; }
        canvas { display: block; }
    </style>
</head>
<body>

<div id="ui-overlay">
    <div class="hud-top">
        <div>LVL: <span id="lvl">12</span></div>
        <div id="island-name" class="island-banner">NEBULA STATION</div>
        <div>HP: 100%</div>
    </div>
</div>

<canvas id="worldCanvas"></canvas>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, set, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyD9I2tePOBy4OdbFjbAzxAPvvziqvoe0QI",
    authDomain: "neonverse-aars.firebaseapp.com",
    projectId: "neonverse-aars",
    storageBucket: "neonverse-aars.firebasestorage.app",
    databaseURL: "https://neonverse-aars-default-rtdb.firebaseio.com",
    messagingSenderId: "612438599755",
    appId: "1:612438599755:web:43f1c0a553d56c3aa045ce"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const canvas = document.getElementById('worldCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth; canvas.height = window.innerHeight;

let me = { id: 'u_'+Math.random().toString(36).substr(2,4), x: 5000, y: 5000, vx: 0, vy: 0, anim: 0, biome: 'nebula' };
let players = {};

// Background Starfield Data
const stars = Array.from({length: 200}, () => ({x: Math.random()*2000, y: Math.random()*2000, s: Math.random()*2}));

const keys = {};
window.onkeydown = (e) => keys[e.code] = true;
window.onkeyup = (e) => keys[e.code] = false;

function drawBackground() {
    // ðŸŒŒ LAYER 1: The Deep Space Gradient
    let grad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width);
    if (me.biome === 'nebula') {
        grad.addColorStop(0, '#0a0020'); grad.addColorStop(1, '#020005');
    } else {
        grad.addColorStop(0, '#200000'); grad.addColorStop(1, '#050000');
    }
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ðŸŒŒ LAYER 2: Parallax Stars
    ctx.save();
    ctx.translate(-(me.x * 0.1) % 2000, -(me.y * 0.1) % 2000);
    ctx.fillStyle = "#fff";
    stars.forEach(s => ctx.fillRect(s.x, s.y, s.s, s.s));
    ctx.restore();
}

function drawHumanoid(p) {
    const sway = Math.sin(p.anim) * 4;
    ctx.save();
    ctx.translate(p.x, p.y);
    
    // Character Shadow/Glow
    ctx.shadowBlur = 25; ctx.shadowColor = (p.id === me.id) ? "#00f2ff" : "#ff00ff";
    
    // Body Parts (Humanoid Pro)
    ctx.fillStyle = "#fff"; // Head
    ctx.beginPath(); ctx.arc(0, -45 + sway, 8, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = ctx.shadowColor; // Torso
    ctx.fillRect(-10, -35 + sway, 20, 30);
    ctx.fillRect(-15, -30 + sway, 5, 20); // Left Arm
    ctx.fillRect(10, -30 + sway, 5, 20);  // Right Arm
    
    ctx.restore();
}

function update() {
    const speed = 8;
    let moving = false;
    if (keys['KeyW']) { me.y -= speed; moving = true; }
    if (keys['KeyS']) { me.y += speed; moving = true; }
    if (keys['KeyA']) { me.x -= speed; moving = true; }
    if (keys['KeyD']) { me.x += speed; moving = true; }
    if (moving) me.anim += 0.15;

    // Biome Logic
    if (me.x > 6000) {
        me.biome = 'crimson';
        document.getElementById('island-name').innerText = "CRIMSON RIFT";
        document.getElementById('island-name').style.color = "#ff0044";
    } else {
        me.biome = 'nebula';
        document.getElementById('island-name').innerText = "NEBULA STATION";
        document.getElementById('island-name').style.color = "#00f2ff";
    }

    set(ref(db, 'players/' + me.id), me);
    onValue(ref(db, 'players'), (s) => players = s.val() || {});

    drawBackground();

    ctx.save();
    ctx.translate(canvas.width/2 - me.x, canvas.height/2 - me.y);

    // Dynamic Grid Floor
    ctx.strokeStyle = (me.biome === 'nebula' ? "#00f2ff22" : "#ff000022");
    ctx.lineWidth = 2;
    for(let i=0; i<10000; i+=200) {
        ctx.strokeRect(i, 0, 200, 10000);
    }

    Object.values(players).forEach(p => drawHumanoid(p));

    ctx.restore();
    requestAnimationFrame(update);
}

onDisconnect(ref(db, 'players/' + me.id)).remove();
update();
</script>
</body>
</html>
